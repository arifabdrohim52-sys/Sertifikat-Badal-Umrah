<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sertifikat Badal Umrah</title>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', 'Times New Roman', serif;
      background: #f7f7fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2d2d2d;
      margin-top: 32px;
      margin-bottom: 8px;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px #e0e0e0;
    }
    .formulir {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 32px 28px 24px 28px;
      margin: 24px 0 32px 0;
      min-width: 340px;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
    }
    .formulir input {
      display: block;
      margin: 0;
      padding: 10px 12px;
      width: 100%;
      border-radius: 8px;
      border: 1px solid #d0d0d0;
      font-size: 1rem;
      background: #fafafd;
      transition: border 0.2s;
    }
    .formulir input:focus {
      border: 1.5px solid #E1306C;
      outline: none;
    }
    .formulir button {
      background: linear-gradient(90deg,#E1306C 60%,#fdc8da 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
      box-shadow: 0 2px 8px #e0e0e0;
      transition: background 0.2s;
    }
    .formulir button:hover {
      background: linear-gradient(90deg,#fdc8da 0%,#E1306C 100%);
    }
    canvas#sertifikatCanvas {
      border: 1.5px solid #E1306C;
      border-radius: 12px;
      width: 800px;
      height: auto;
      margin-bottom: 32px;
      box-shadow: 0 4px 24px rgba(225,48,108,0.08);
    }
    .tandaTangan {
      border: 1.5px dashed #E1306C;
      border-radius: 8px;
      width: 320px;
      height: 120px;
      background: #fff0f6;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h1>Form Sertifikat Badal Umrah</h1>
  <div style="margin-bottom: 16px; text-align:center;">
    <span style="font-size:18px; color:#E1306C; font-weight:600; letter-spacing:0.5px;">Hak cipta milik Arif Abd Rohim</span>
    <br>
    <a href="https://www.instagram.com/arifabdrohim?igsh=YnRwZGdsNTlxdjQ1" target="_blank" style="display:inline-block; margin-top:8px; padding:8px 24px; background:#E1306C; color:#fff; border-radius:8px; text-decoration:none; font-weight:bold; font-size:1rem; box-shadow:0 2px 8px #e0e0e0;">Instagram</a>
  </div>
  <div class="formulir">
  <input id="nama" placeholder="Nama Penerima" oninput="generate()">
  <input id="miqat" placeholder="Tempat Miqat" oninput="generate()">
  <input id="tanggal" type="date" placeholder="Tanggal Miqat" oninput="generate()">
  <input id="pelaksana" placeholder="Nama Pelaksana" oninput="generate()">
    <canvas id="ttdPelaksana" class="tandaTangan"></canvas>
    <button onclick="clearTTD(pelaksanaPad)">Clear TTD Pelaksana</button>
  <input id="saksi" placeholder="Nama Saksi" oninput="generate()">
    <canvas id="ttdSaksi" class="tandaTangan"></canvas>
    <button onclick="clearTTD(saksiPad)">Clear TTD Saksi</button>
  <label style="width:100%; display:inline-flex; align-items:center; gap:0px; text-align:left; margin-top:8px; white-space:nowrap;">
      Semua data sudah terisi <input type="checkbox" id="ceklistLengkap" onchange="generate()">
    </label>
    <br><br>
  <button onclick="downloadPNG()">Download PNG</button>
  <button onclick="downloadPDF()">Download PDF</button>
  </div>

  <canvas id="sertifikatCanvas" width="2488" height="3524"></canvas>

  <script>
    // Fungsi untuk mendapatkan nama hari dari tanggal
    function getHariTanggal(tanggalStr) {
      if (!tanggalStr) return "";
      const hariList = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
      const bulanList = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
      const tgl = new Date(tanggalStr);
      const hari = hariList[tgl.getDay()];
      const dd = String(tgl.getDate()).padStart(2, '0');
      const namaBulan = bulanList[tgl.getMonth()];
      const yyyy = tgl.getFullYear();
      return `${hari}, ${dd} ${namaBulan} ${yyyy}`;
    }
    const canvas = document.getElementById("sertifikatCanvas");
    const ctx = canvas.getContext("2d");

    const bg = new Image();
  bg.src = "Gambar Sertifikat.jpg"; // file sertifikat Anda

  const ttdPelaksana = document.getElementById("ttdPelaksana");
  const pelaksanaPad = new SignaturePad(ttdPelaksana);
  const ttdSaksi = document.getElementById("ttdSaksi");
  const saksiPad = new SignaturePad(ttdSaksi);

  // Update preview otomatis saat tanda tangan digambar
    pelaksanaPad.onEnd = generate;
    saksiPad.onEnd = function() {
      generate();
    };

    function clearTTD(pad) { pad.clear(); }

    function generate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "black";
      ctx.textAlign = "center";

      // Nama penerima
  ctx.font = "bold 90px 'Times New Roman'";
  ctx.fillText(document.getElementById("nama").value, canvas.width/2, 1750);

      // Tempat miqat
  ctx.font = "60px 'Times New Roman'";
  ctx.textAlign = "center";
  ctx.fillText(document.getElementById("miqat").value, canvas.width/2, 1928);

      // Tanggal
  ctx.textAlign = "center";
  const tanggalValue = document.getElementById("tanggal").value;
  ctx.fillText(getHariTanggal(tanggalValue), canvas.width/2, 2032);

      // Nama Pelaksana
  ctx.textAlign = "center";
  ctx.font = "55px 'Times New Roman'";
  ctx.fillText(document.getElementById("pelaksana").value, 814, 3125);

      // Nama Saksi
  ctx.fillText(document.getElementById("saksi").value, 1832, 3125);

      // Tanda tangan Pelaksana
      if (!pelaksanaPad.isEmpty()) {
        const ttdImg = new Image();
        ttdImg.src = pelaksanaPad.toDataURL();
        ttdImg.onload = () => {
          // Center tanda tangan di rentang x:508 sampai x:1120
          const ttdWidth = 500;
          const ttdHeight = 180;
          const rentangX1 = 508;
          const rentangX2 = 1120;
          const centerX = (rentangX1 + rentangX2) / 2 - ttdWidth / 2;
          ctx.drawImage(ttdImg, centerX, 2940, ttdWidth, ttdHeight);
        };
      }

      // Tanda tangan Saksi
      if (!saksiPad.isEmpty()) {
        const ttdWidth = 500;
        const ttdHeight = 180;
        const rentangX1 = 1552;
        const rentangX2 = 2132;
        const centerX = (rentangX1 + rentangX2) / 2 - ttdWidth / 2;
        ctx.save();
        const ttdImg = saksiPad.toDataURL();
        const img = document.createElement('img');
        img.src = ttdImg;
        img.onload = function() {
          ctx.drawImage(img, centerX, 2940, ttdWidth, ttdHeight);
        };
        // Jika gambar sudah di-cache, langsung gambar
        if (img.complete) {
          ctx.drawImage(img, centerX, 2940, ttdWidth, ttdHeight);
        }
        ctx.restore();
      }
    }

    function downloadPNG() {
      const link = document.createElement("a");
      link.download = "sertifikat.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "pt", [2488, 3524]);
      const imgData = canvas.toDataURL("image/png");
      pdf.addImage(imgData, "PNG", 0, 0, 2488, 3524);
      pdf.save("sertifikat.pdf");
    }

    bg.onload = generate;
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sertifikat Badal Umrah</title>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { 
      font-family: "Times New Roman", serif; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
    }
    .formulir { margin: 20px; }
    .formulir input { display: block; margin: 10px 0; padding: 6px; width: 250px; }
    canvas#sertifikatCanvas { 
      border: 1px solid #333; 
      width: 800px;  /* scaled tampil di layar */
      height: auto; 
    }
    .tandaTangan { border: 1px solid #000; width: 300px; height: 120px; }
  </style>
</head>
<body>
  <h1>Form Sertifikat Badal Umrah</h1>
  <div class="formulir">
    <input id="nama" placeholder="Nama Penerima">
    <input id="miqat" placeholder="Tempat Miqat">
    <input id="tanggal" placeholder="Hari, Tanggal">
    <input id="pelaksana" placeholder="Nama Pelaksana">
    <canvas id="ttdPelaksana" class="tandaTangan"></canvas>
    <button onclick="clearTTD(pelaksanaPad)">Clear TTD Pelaksana</button>
    <input id="saksi" placeholder="Nama Saksi">
    <canvas id="ttdSaksi" class="tandaTangan"></canvas>
    <button onclick="clearTTD(saksiPad)">Clear TTD Saksi</button>
    <br><br>
    <button onclick="generate()">Preview Sertifikat</button>
    <button onclick="downloadPNG()">Download PNG</button>
    <button onclick="downloadPDF()">Download PDF</button>
  </div>

  <canvas id="sertifikatCanvas" width="2488" height="3524"></canvas>

  <script>
    const canvas = document.getElementById("sertifikatCanvas");
    const ctx = canvas.getContext("2d");

    const bg = new Image();
    bg.src = "IMG_20250921_160914_371.jpg"; // file sertifikat Anda

    const ttdPelaksana = document.getElementById("ttdPelaksana");
    const pelaksanaPad = new SignaturePad(ttdPelaksana);
    const ttdSaksi = document.getElementById("ttdSaksi");
    const saksiPad = new SignaturePad(ttdSaksi);

    function clearTTD(pad) { pad.clear(); }

    function generate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "black";
      ctx.textAlign = "center";

      // Nama penerima
      ctx.font = "bold 90px 'Times New Roman'";
      ctx.fillText(document.getElementById("nama").value, canvas.width/2, 1500);

      // Tempat miqat
      ctx.font = "60px 'Times New Roman'";
      ctx.textAlign = "left";
      ctx.fillText(document.getElementById("miqat").value, 600, 3050);

      // Tanggal
      ctx.textAlign = "right";
      ctx.fillText(document.getElementById("tanggal").value, 1880, 3050);

      // Nama Pelaksana
      ctx.textAlign = "center";
      ctx.font = "55px 'Times New Roman'";
      ctx.fillText(document.getElementById("pelaksana").value, 900, 3300);

      // Nama Saksi
      ctx.fillText(document.getElementById("saksi").value, 1800, 3300);

      // Tanda tangan Pelaksana
      if (!pelaksanaPad.isEmpty()) {
        const ttdImg = new Image();
        ttdImg.src = pelaksanaPad.toDataURL();
        ttdImg.onload = () => {
          ctx.drawImage(ttdImg, 700, 3120, 400, 150);
        };
      }

      // Tanda tangan Saksi
      if (!saksiPad.isEmpty()) {
        const ttdImg = new Image();
        ttdImg.src = saksiPad.toDataURL();
        ttdImg.onload = () => {
          ctx.drawImage(ttdImg, 1600, 3120, 400, 150);
        };
      }
    }

    function downloadPNG() {
      const link = document.createElement("a");
      link.download = "sertifikat.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "pt", [2488, 3524]);
      const imgData = canvas.toDataURL("image/png");
      pdf.addImage(imgData, "PNG", 0, 0, 2488, 3524);
      pdf.save("sertifikat.pdf");
    }

    bg.onload = generate;
  </script>
</body>
</html>
